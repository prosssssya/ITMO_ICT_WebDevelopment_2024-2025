# Модель базы данных

Создать программную систему, предназначенную для диспетчера автобусного
парка частной транспортной фирмы. Фима обслуживает несколько коммерческих
маршрутов. Такая система должна обеспечивать хранение сведений о водителях, о
маршрутах и характеристиках автобусов.
Каждый водитель характеризуется паспортными данными, классом, стажем
работы и окладом, причем оклад зависит от класса и стажа работы.
Маршрут автобуса характеризуется номером маршрута, названием начального и
конечного пункта движения, временем начала и конца движения, интервалом движения и
протяженностью в минутах (время движения от кольца до кольца). Характеристиками
автобуса являются: номер государственной регистрации автобуса, его тип и
вместимость, причем вместимость автобуса зависит от его типа.
Каждый водитель закреплен за определенным автобусом и работает на
определенном маршруте, но в случае поломки своего автобуса или болезни другого
водителя может пересесть на другую машину.
В базе должен храниться график работы водителей.
Необходимо предусмотреть возможность корректировки БД в случаях
поступления на работу нового водителя, списания старого автобуса, введения нового
маршрута или изменения старого и т.п.  

Диспетчеру автопарка могут потребоваться следующие сведения:  

1. Список водителей, работающих на определенном маршруте с указанием
графика их работы?  

2. Когда начинается и заканчивается движение автобусов на каждом маршруте?  

3. Какова общая протяженность маршрутов, обслуживаемых автопарком?  

4. Какие автобусы не вышли на линию в заданный день и по какой причине
(неисправность, отсутствие водителя)?  

5. Сколько водителей каждого класса работает в автопарке?  

Необходимо предусмотреть возможность выдачи отчета по автопарку,
сгруппированного по типам автобусов, с указанием маршрутов, обслуживаемых
автобусами каждого типа. Для маршрутов должны быть указаны все характеристики,
включая списки автобусов и водителей, обслуживающих каждый маршрут. Отчет
должен содержать сведения о суммарной протяженности обслуживаемых маршрутов,
о количестве имеющихся в автопарке автобусов каждого типа, о количестве водителей,
их среднем возрасте и стаже.

![img.png](1.jpg)  
models.py

    class Driver(models.Model):
        class DriverStatus(models.TextChoices):
            ACTIVE = 'На работе', _('На работе')
            WEEKEND = 'Выходной', _('Выходной')
            REST = 'В отпуске', _('В отпуске')
            ILLNESS = 'На больничном', _('На больничном')
            TRIP = 'В командировке', _('В командировке')
    
        name = models.CharField(max_length=30, verbose_name="Имя")
        surname = models.CharField(max_length=30, verbose_name="Фамилия")
        passport = models.CharField(max_length=10, unique=True, verbose_name="Паспортные данные")
        driver_class = models.CharField(max_length=20, verbose_name="Класс водителя")
        experience = models.PositiveIntegerField(verbose_name="Стаж работы (лет)")
        salary = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="Оклад")
        date_of_birth = models.DateField(verbose_name="Дата рождения")
        status = models.CharField(max_length=30, choices=DriverStatus.choices, verbose_name="Статус")
        routes = models.ManyToManyField('Route', verbose_name="Маршруты", related_name="drivers")
    
        def __str__(self):
            return f"{self.name} {self.surname} ({self.driver_class})"
    
    
    class Route(models.Model):
        route_num = models.PositiveIntegerField(verbose_name="Номер маршрута", unique=True)
        start_point = models.CharField(max_length=30, verbose_name="Начальный пункт")
        end_point = models.CharField(max_length=30, verbose_name="Конечный пункт")
        start_time = models.TimeField(verbose_name="Время начала движения")
        end_time = models.TimeField(verbose_name="Время конца движения")
        interval = models.PositiveIntegerField(verbose_name="Интервал движения (мин.)")
        duration = models.PositiveIntegerField(verbose_name="Длительность (мин.)")
    
        def __str__(self):
            return f"Маршрут {self.route_num}: {self.start_point} - {self.end_point}"
    
    
    class Bus(models.Model):
        class BusStatus(models.TextChoices):
            AVAILABLE = 'Свободен', _('Свободен')
            IN_REPAIR = 'В ремонте', _('В ремонте')
            UNAVAILABLE = 'Занят', _('Занят')
    
        registration_num = models.CharField(max_length=20, unique=True, verbose_name="Регистрационный номер")
        type = models.CharField(max_length=30, verbose_name="Тип автобуса")
        capacity = models.PositiveIntegerField(verbose_name="Вместимость")
        status = models.CharField(max_length=30, choices=BusStatus.choices, verbose_name="Статус")
    
        def __str__(self):
            return f"{self.registration_num} ({self.type})"
    
    
    
    class DriverSchedule(models.Model):
        driver = models.ForeignKey(Driver, on_delete=models.CASCADE, verbose_name="Водитель")
        bus = models.ForeignKey(Bus, on_delete=models.CASCADE, verbose_name="Автобус")
        route = models.ForeignKey(Route, on_delete=models.CASCADE, verbose_name="Маршрут")
        work_date = models.DateField(verbose_name="Дата работы")
        shift_start = models.TimeField(verbose_name="Начало смены")
        shift_end = models.TimeField(verbose_name="Конец смены")
    
        class Meta:
            constraints = [
                models.UniqueConstraint(
                    fields=["driver", "bus", "route", "work_date"],
                    name="unique_schedule_entry"
                )
            ]
    
        def __str__(self):
            return f"{self.driver.name} on {self.route.route_num} ({self.work_date})"
    
    
    class BusAssignment(models.Model):
        bus = models.ForeignKey(Bus, on_delete=models.CASCADE, verbose_name="Автобус")
        route = models.ForeignKey(Route, on_delete=models.CASCADE, verbose_name="Маршрут")
        start_date = models.DateField(verbose_name="Дата начала")
        end_date = models.DateField(verbose_name="Дата окончания", null=True, blank=True)
    
        def __str__(self):
            return f"{self.bus.registration_num} on {self.route.route_num}"
    
    
    class Maintenance(models.Model):
        class MaintenanceStatus(models.TextChoices):
            PENDING = 'В процессе', _('В процессе')
            COMPLETED = 'Починен', _('Починен')
    
        bus = models.ForeignKey(Bus, on_delete=models.CASCADE, verbose_name="Автобус")
        maintenance_date = models.DateField(verbose_name="Дата обслуживания")
        reason = models.CharField(max_length=30, verbose_name="Причина")
        status = models.CharField(max_length=30, choices=MaintenanceStatus.choices, verbose_name="Статус")
    
        def __str__(self):
            return f"Maintenance on {self.bus.registration_num} ({self.maintenance_date})"
