# Реализация клиентских интерфейсов

###  Настройка CORS в Django REST framework

Для упрощения работы с HTTP-запросами использовала библиотеку Axios:

    import axios from 'axios';
    
    const apiClient = axios.create({
      baseURL: 'http://127.0.0.1:8000/bus/',
      headers: {
        'Content-Type': 'application/json',
      },
    });
    
    apiClient.interceptors.request.use((config) => {
      const token = localStorage.getItem('token');
      if (token) {
        config.headers.Authorization = `Token ${token}`;
      }
      return config;
    }, (error) => {
      return Promise.reject(error);
    });
    
    export default apiClient;



Добавила функции для работы с токенами аутентификации:  

    import axios from 'axios';

    const BASE_URL = 'http://127.0.0.1:8000/auth/token/login/';
    
    export default {
      login(credentials) {
        return axios.post(BASE_URL, credentials)
          .then(response => {
            const token = response.data.auth_token;
            console.log('Token:', token);
            localStorage.setItem('token', token);
            return token;
          })
          .catch(error => {
            console.error('Ошибка при логине:', error);
            throw error;
          });
      },
      logout() {
        localStorage.removeItem('token');
      },
    };



Затем добавила corsheaders.middleware.CorsMiddleware в “MIDDLEWARE_CLASSES” в settings.py:

    MIDDLEWARE_CLASSES = (
        'corsheaders.middleware.CorsMiddleware',
        'django.middleware.common.BrokenLinkEmailsMiddleware',
        'django.middleware.common.CommonMiddleware',
        #...
    )

Настройка маршрутизации:
    
    const routes = [
      {
        path: '/',
        name: 'Home',
        component: () => import('@/views/HomeView.vue'),
      },
      { path: '/login', name: 'Login', component: LoginView },
      { path: '/register', name: 'Register', component: RegisterView },
      { path: '/drivers', name: 'DriverList', component: DriverList },
      { path: "/drivers/:id", name: 'DriverDetail', component: DriverDetail },
      { path: '/routes', name: 'RouteList', component: RouteList },
      { path: '/routes/:id', name: 'RouteDetail', component: RouteDetail },
      { path: '/buses', name: 'BusList', component: BusList },
      { path: '/buses/:id', name: 'BusDetail', component: BusDetail },
      { path: '/driver-schedules', name: 'ScheduleList', component: ScheduleList },
      { path: '/driver-schedule/:id', name: 'ScheduleDetail', component: ScheduleDetail },
      { path: '/assignment', name: 'AssignmentList', component: AssignmentList },
      { path: '/assignment/:id', name: 'AssignmentDetail', component: AssignmentDetail },
      { path: '/maintenances', name: 'MaintenanceList', component: MaintenanceList },
      { path: '/maintenance/:id/update', name: 'MaintenanceDetail', component: MaintenanceDetail },
    ];
    
    const router = createRouter({
      history: createWebHistory(),
      routes,
    });
    
    export default router;

Пример реализации функционала для водителя: 
    
### DriverList.vue  
    <template>
      <div>
        <h1>Список водителей</h1>
    
        <div class="actions-container">
          <div class="filter-container">
            <label for="class-filter" style="font-size: 16px;">Класс вождения:</label>
            <select id="class-filter" class="filter-select" v-model="selectedClass" @change="filterByClass">
              <option value="">Все классы</option>
              <option v-for="classType in driverClasses" :key="classType">
                {{ classType }}
              </option>
            </select>
          </div>
          <button @click="showModal = true" class="add">Добавить водителя</button>
        </div>
    
        <table v-if="drivers.length > 0">
          <thead>
            <tr>
              <th>Водитель</th>
              <th>Класс</th>
              <th>Статус</th>
              <th>Маршруты</th>
              <th>Действия</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="driver in filteredDrivers" :key="driver.id">
              <td>
                <router-link :to="`/drivers/${driver.id}`" class="driver-link">
                  {{ driver.name }} {{ driver.surname }}
                </router-link>
              </td>
              <td>{{ driver.driver_class }}</td>
              <td>{{ driver.status }}</td>
              <td>
                <span v-for="(route, index) in driver.routes" :key="route.id">
                  {{ route.start_point }} - {{ route.end_point }}<span v-if="index < driver.routes.length - 1">, </span>
                </span>
              </td>
              <td>
                <button @click="deleteDriver(driver.id)" class="delete-btn">Удалить</button>
              </td>
            </tr>
          </tbody>
        </table>
    
        <p v-else>Данных нет</p>
    
        <div v-if="showModal" class="modal-overlay">
          <div class="modal-content">
            <button class="modal-close" @click="showModal = false">×</button>
            <!-- Вставляем компонент DriverModal -->
            <DriverModal @close="showModal = false" @driver-added="fetchDrivers" />
          </div>
        </div>
      </div>
    </template>
    
    
    <script>
    import axios from 'axios';
    import DriverModal from "@/components/DriverModal.vue";
    import apiClient from "@/api/axios";
    
    export default {
      components: {
          DriverModal
        },
      data() {
        return {
          drivers: [],
          routes: [],
          selectedRoute: "",
          selectedClass: "",
          showModal: false,
          driverClasses: ["A", "B", "D1", "D"],
        };
      },
      computed: {
        filteredDrivers() {
          return this.drivers.filter(driver => {
            const matchesRoute =
              !this.selectedRoute || driver.routes.some(route => route.id == this.selectedRoute);
            const matchesClass = !this.selectedClass || driver.driver_class === this.selectedClass;
            return matchesRoute && matchesClass;
          });
        },
      },
      methods: {
        async fetchDrivers() {
            try {
                const response = await apiClient.get('/drivers/');
                console.log(response.data);
                this.drivers = response.data;
            } catch (error) {
                console.error('Fetch error:', error.response || error.message);
            }
        },
        async deleteDriver(driverId) {
          // Запрос подтверждения удаления
          const confirmDelete = window.confirm('Вы уверены, что хотите удалить этого водителя?');
          if (!confirmDelete) return;
    
          try {
    
            await apiClient.delete(`/drivers/${driverId}/delete/`);
    
            this.drivers = this.drivers.filter(driver => driver.id !== driverId);
    
            alert('Водитель успешно удалён!');
          } catch (error) {
            console.error('Ошибка при удалении водителя:', error.response || error.message);
            alert('Не удалось удалить водителя. Попробуйте позже.');
          }
        },
        filterByRoute() {
    
        },
        filterByClass() {
    
        },
      },
      async created() {
        await this.fetchDrivers();
      },
    };
    </script>
    
### DriverDetail.vue  
    <template>
      <div class="form-container">
        <h1>Информация о водителе</h1>
        <form @submit.prevent="updateDriver">
          <div class="form-group">
            <label for="name">Имя:</label>
            <input v-model="driver.name" class="colour" id="name" placeholder="Введите имя" required />
          </div>
          <div class="form-group">
            <label for="surname">Фамилия:</label>
            <input v-model="driver.surname" class="colour" id="surname" placeholder="Введите фамилию" required />
          </div>
          <div class="form-group">
            <label for="passport">Паспорт:</label>
            <input v-model="driver.passport" class="colour" id="passport" placeholder="Введите паспортные данные" required />
          </div>
          <div class="form-group">
            <label for="driverClass">Класс водителя:</label>
            <select v-model="driver.driver_class" class="colour" id="driverClass" required>
              <option v-for="classType in driverClasses" :key="classType" :value="classType">
                {{ classType }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="experience">Стаж работы (лет):</label>
            <input v-model.number="driver.experience" class="colour" id="experience" type="number" min="0" placeholder="Введите стаж" required />
          </div>
          <div class="form-group">
            <label for="salary">Оклад:</label>
            <input v-model.number="driver.salary" class="colour" id="salary" type="number" step="0.01" placeholder="Введите оклад" required />
          </div>
          <div class="form-group">
            <label for="dateOfBirth">Дата рождения:</label>
            <input v-model="driver.date_of_birth" class="colour" id="dateOfBirth" type="date" required />
          </div>
          <div class="form-group">
            <label for="status">Статус:</label>
            <select v-model="driver.status" class="colour" id="status" required>
              <option v-for="statusOption in driverStatuses" :key="statusOption.value" :value="statusOption.value">
                {{ statusOption.label }}
              </option>
            </select>
          </div>
    
          <div class="form-buttons">
            <button type="submit">Сохранить</button>
            <router-link to="/drivers" class="back-to-list-btn">
              Вернуться к списку водителей
            </router-link>
          </div>
        </form>
      </div>
    </template>
    
    <script>
    import apiClient from "@/api/axios";
    import Header from "@/components/Header.vue";
    
    export default {
      components: {
        Header,
      },
      data() {
        return {
          driver: null,
          driverClasses: ["A", "B", "D1", "D"],
          driverStatuses: [
            { value: "На работе", label: "На работе" },
            { value: "Выходной", label: "Выходной" },
            { value: "В отпуске", label: "В отпуске" },
            { value: "На больничном", label: "На больничном" },
            { value: "В командировке", label: "В командировке" },
            { value: "Уволен", label: "Уволен" },
          ],
        };
      },
      async created() {
        try {
          const driverId = this.$route.params.id;
          const response = await apiClient.get(`/drivers/${driverId}/`);
          this.driver = response.data;
        } catch (error) {
          console.error("Ошибка при загрузке данных водителя:", error);
        }
      },
      methods: {
        async updateDriver() {
          try {
            const driverId = this.$route.params.id;
            await apiClient.put(`/drivers/${driverId}/update/`, this.driver);
            alert("Данные обновлены!");
          } catch (error) {
            console.error("Ошибка при обновлении данных:", error);
          }
        },
      },
    };
    </script>

### DriverModal.vue  
    <template>
      <div class="modal-overlay" @click="handleOverlayClick">
        <div class="form-container" @click.stop>
          <h1>Информация о водителе</h1>
          <form @submit.prevent="updateDriver">
            <div class="form-group">
              <label for="name">Имя:</label>
              <input v-model="driver.name" class="colour" id="name" placeholder="Введите имя" required />
            </div>
            <div class="form-group">
              <label for="surname">Фамилия:</label>
              <input v-model="driver.surname" class="colour" id="surname" placeholder="Введите фамилию" required />
            </div>
            <div class="form-group">
              <label for="passport">Паспорт:</label>
              <input v-model="driver.passport" class="colour" id="passport" placeholder="Введите паспортные данные" required />
            </div>
            <div class="form-group">
              <label for="driverClass">Класс водителя:</label>
              <select v-model="driver.driver_class" class="colour" id="driverClass" required>
                <option v-for="classType in driverClasses" :key="classType" :value="classType">
                  {{ classType }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="experience">Стаж работы (лет):</label>
              <input v-model.number="driver.experience" class="colour" id="experience" type="number" min="0" placeholder="Введите стаж" required />
            </div>
            <div class="form-group">
              <label for="salary">Оклад:</label>
              <input v-model.number="driver.salary" class="colour" id="salary" type="number" step="0.01" placeholder="Введите оклад" required />
            </div>
            <div class="form-group">
              <label for="dateOfBirth">Дата рождения:</label>
              <input v-model="driver.date_of_birth" class="colour" id="dateOfBirth" type="date" required />
            </div>
            <div class="form-group">
              <label for="status">Статус:</label>
              <select v-model="driver.status" class="colour" id="status" required>
                <option v-for="statusOption in driverStatuses" :key="statusOption.value" :value="statusOption.value">
                  {{ statusOption.label }}
                </option>
              </select>
            </div>
    
            <div class="form-buttons">
              <button type="submit">Сохранить</button>
              <button type="button" @click="closeModal">Закрыть</button>
            </div>
          </form>
        </div>
      </div>
    </template>
    
    
    <script>
    import apiClient from "@/api/axios";
    
    export default {
      data() {
        return {
          driver: {
            name: "",
            surname: "",
            passport: "",
            driver_class: "",
            experience: 0,
            salary: 0.0,
            date_of_birth: "",
            status: "",
          },
          driverClasses: ["A", "B", "D1", "D"],
          driverStatuses: [
            { value: "На работе", label: "На работе" },
            { value: "Выходной", label: "Выходной" },
            { value: "В отпуске", label: "В отпуске" },
            { value: "На больничном", label: "На больничном" },
            { value: "В командировке", label: "В командировке" },
          ],
        };
      },
      methods: {
        closeModal() {
          this.$emit('close');
        },
    
        formatDataForSubmission() {
          return {
            name: this.driver.name,
            surname: this.driver.surname,
            passport: this.driver.passport,
            driver_class: this.driver.driver_class,
            experience: this.driver.experience,
            salary: this.driver.salary,
            date_of_birth: this.driver.date_of_birth,
            status: this.driver.status,
          };
        },
    
        async updateDriver() {
          try {
            const formattedData = this.formatDataForSubmission();
            await apiClient.post("/drivers/create/", formattedData);
            this.$emit('driver-added');
            this.closeModal();
          } catch (error) {
            console.error("Ошибка при добавлении водителя:", error);
          }
        },
        handleOverlayClick() {
          this.closeModal();
        },
      },
    };
    </script>